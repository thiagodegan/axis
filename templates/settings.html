{% extends "base.html" %} 
{% block content %}
<div class="rounded-3xl bg-slate-800 shadow-xl p-10 text-white border-slate-700 border">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="space-y-2">
        {% for category, message in messages %}
          <div class="rounded-lg p-3 text-sm 
            {% if category == 'success' %}bg-green-900 text-green-400 border border-green-700{% endif %}
            {% if category == 'error' %}bg-red-900 text-red-400 border border-red-700{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="rounded-2xl bg-slate-800 p-6 text-center">
    <h2 class="text-xl font-semibold mb-10 text-slate-100">Configurações</h2>

    <p class="text-sm mb-4 text-slate-200">
      Token do GitHub (PAT): 
      {% if has_token %}
        <span class="inline-flex items-center gap-2 text-green-400">
          configurado
          <span class="text-xs text-slate-400">(salvo criptografado)</span> ✅
        </span>
      {% else %}
        <span class="text-red-400">não configurado ❌</span>
      {% endif %}
    </p>

    <form method="post" action="{{ url_for('settings_post') }}" class="space-y-3">
      <label class="block text-sm font-medium text-slate-100">GitHub Personal Access Token</label>
      <input
        name="github_token"
        type="password"
        class="w-full rounded-xl border border-slate-700 bg-slate-900 text-slate-100 px-3 py-2 outline-none focus:ring focus:ring-blue-400"
        placeholder="ghp_..."
      />
      <div class="flex justify-center items-center gap-3 mt-3">
        <button class="rounded-xl bg-blue-600 text-white px-4 py-2 hover:opacity-90">
          Salvar
        </button>
        <button type="submit" form="settings_test_form" class="rounded-xl border border-slate-700 px-4 py-2 text-slate-100 hover:bg-slate-700">
          Testar conexão
        </button>
      </div>
    </form>

    <!-- Formulário separado para teste de conexão (mantendo POST) -->
    <form method="post" action="{{ url_for('settings_test') }}" id="settings_test_form" class="hidden"></form>

  </div>
</div>
{% endblock %}
